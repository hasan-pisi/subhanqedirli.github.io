<html><head><style>body {
   color: black;
}
</style>
<meta charset="UTF-8">
</head><body><h1 id="qemu-kvm-kullan-m-">Qemu-KVM kullanımı</h1>
<p>Bu belgede <strong>qemu-kvm</strong> kullanımı anlatılmaktadır. İşin teknik detayından çok kullanmak isteyenlerin işini görmesi için basitleştirerek anlatmaya çalışacağız.</p>
<p>Not: Bu belgede <strong>debian sid</strong> üzerinde olduğunuzu varsayarak anlatım yaptım ama diğer dağıtımlarda da benzer şekilde kullanımı var.</p>
<p>Qemu kullanmak için <strong>gui</strong> uygulamalar da vardır. Örneğin <em>gnome-boxes</em> ile qemuyu grafik tabanlı olarak kullanabilirsiniz. Bu belgede buna değinmeyeceğiz. terminalden kullanımı üzerine anlatım olacak.</p>
<h2 id="qemu-kurulumu">Qemu kurulumu</h2>
<p>Debian için <strong>apt-get install qemu-kvm</strong> komutunu kullanabiliriz. Uefi bios ile kullanmak için <strong>ovmf</strong> paketine gerek duyulmaktadır. onuda debian için <strong>apt-get install ovfm</strong> komutu ile kurabiliriz.</p>
<h2 id="disk-imaj-olu-turma">Disk imajı oluşturma</h2>
<p><strong>qemu-img</strong> komutu ile kolay yoldan imaj açabiliriz. boyutunu <strong>G</strong> <strong>M</strong> gibi harfler ile ifade ediyoruz. Örneğin:</p>
<pre><code class="lang-bash">$ qemu-<span class="hljs-selector-tag">img</span> create deneme<span class="hljs-selector-class">.img</span> <span class="hljs-number">30</span>G
Formatting <span class="hljs-string">'deneme.img'</span>, fmt=raw size=<span class="hljs-number">32212254720</span>
</code></pre>
<p>Bu disk imajı <strong>raw</strong> formattadır. yani disk imajını usb belleğe <em>dd</em> komutu ile yazıp daha sonra bunu kullanabilirsiniz.</p>
<p><strong>Raw</strong> yerine <strong>qcow2</strong> formatta oluşturmak isterseniz <strong>-f qcow2</strong> parametresini ekleyebilirsiniz. Örneğin:</p>
<pre><code class="lang-bash">$ qemu-<span class="hljs-selector-tag">img</span> create -f qcow2 deneme<span class="hljs-selector-class">.qcow2</span> <span class="hljs-number">30</span>G
</code></pre>
<p><strong>Raw</strong> imajlar çok fantastik şeyler yaparsanız diske zarar verebilir. <strong>Qcow2</strong> imajlar ise daha az zararlıdır ama <em>dd</em> komutu ile doğrudan basıp kullanılamaz.</p>
<h2 id="sanal-makinan-n-ba-lat-lmas-">Sanal makinanın başlatılması</h2>
<p><strong>qemu-system-x86_64</strong> komutu ile başlatılır. <strong>--enable-kvm</strong> parametresi eklenerek <strong>kvm</strong> etkinleştirilmelidir. yoksa çok kasar. Debianda <strong>kvm</strong> komutu bu komutun kısa halidir. eğer <strong>kvm</strong> komutu yoksa <strong>bashrc</strong> içine <strong>alias</strong> ekleyebilirsiniz. Örnek kullanım:</p>
<pre><code class="lang-bash"><span class="hljs-symbol">$</span> qemu-<span class="hljs-keyword">system</span>-x86_64 --enable-kvm
</code></pre>
<p>Ardından oluşturduğumuz disk imajını qemuya hard disk olarak bağlamamız gerekli. onun için de <strong>-hda</strong> parametresi kullanılır. Ayrıca <strong>-m</strong> parametresi ile bellek miktarını <strong>G</strong> <strong>M</strong> gibi semboller ile göstererek belirtmemiz gerekli. Örneğin:</p>
<pre><code class="lang-bash">$ qemu-<span class="hljs-keyword">system</span>-x86_64 <span class="hljs-comment">--enable-kvm -hda deneme.img -m 2G</span>
WARNING: Image <span class="hljs-built_in">format</span> was <span class="hljs-keyword">not</span> specified <span class="hljs-keyword">for</span> <span class="hljs-string">'deneme.img'</span> <span class="hljs-keyword">and</span> probing guessed raw.
       Automatically detecting <span class="hljs-keyword">the</span> <span class="hljs-built_in">format</span> is dangerous <span class="hljs-keyword">for</span> raw images, <span class="hljs-built_in">write</span> operations <span class="hljs-keyword">on</span> <span class="hljs-title">block</span> <span class="hljs-title">0</span> <span class="hljs-title">will</span> <span class="hljs-title">be</span> <span class="hljs-title">restricted</span>.
       Specify <span class="hljs-keyword">the</span> <span class="hljs-string">'raw'</span> <span class="hljs-built_in">format</span> explicitly <span class="hljs-built_in">to</span> remove <span class="hljs-keyword">the</span> restrictions.
</code></pre>
<p>Örnekteki gibi uyarı vermesinin sebebi raw disk imajı kullanmamızdan dolayı. Çok fantastik şeyler yapmayacaksak çokta önemli değil :D Ayrıca raw imaj yerine usb bellek hard disk gibi şeyleri de kullanabilirsiniz. imaj konumu olarak /dev/sdx vermeniz yeterlidir.</p>
<p>Şimdi sıra geldi sanal makinaya format atmaya. Bunun için iso imajını bağlamak gerekli. bunun için <strong>-cdrom</strong> parametresi kullanılmalıdır. Örneğin:</p>
<pre><code class="lang-bash">$ qemu-system-x86_64 --enable-kvm -hda deneme.img -m <span class="hljs-number">2</span>G -cdrom debian-live<span class="hljs-number">-10.4</span><span class="hljs-number">.0</span>-amd64-gnome.iso
</code></pre>
<p><strong>Uefi</strong> bios için <strong>ovmf</strong> eklememiz gerekir. onun için <strong>-bios /usr/share/ovmf/OVMF.fd</strong> parametresi eklenebilir. (bu dosyanın konumu dağıtımdan dağıtıma değişebilir.)</p>
<pre><code>$ qemu-system-x86_64 --enable-kvm -hda deneme<span class="hljs-selector-class">.img</span> -m <span class="hljs-number">2</span>G -cdrom debian-live-<span class="hljs-number">10.4</span>.<span class="hljs-number">0</span>-amd64-gnome<span class="hljs-selector-class">.iso</span> -bios /usr/share/ovmf/OVMF.fd
</code></pre><h2 id="baz-parametreler">Bazı parametreler</h2>
<p>Doğrudan tablo şeklinde vermeyi düşündüm. Bu belgeyi okumaya üşenip buraya bakabilirsiniz.</p>
<table>
<thead>
<tr>
<th>Parametreler</th>
<th>Anlamları</th>
</tr>
</thead>
<tbody>
<tr>
<td>-boot d</td>
<td>cdrom ile başlat</td>
</tr>
<tr>
<td>-boot c</td>
<td>hdd ile başlat</td>
</tr>
<tr>
<td>-m 3G</td>
<td>3gb ram kullan</td>
</tr>
<tr>
<td>--enable-kvm</td>
<td>KVM etkinleştir</td>
</tr>
<tr>
<td>-cdrom xx</td>
<td>iso dosyasını cdrom olarak ayarla</td>
</tr>
<tr>
<td>-hda xx</td>
<td>birinci hard disk imajı</td>
</tr>
<tr>
<td>-hdb xx</td>
<td>ikinci hard disk imajı</td>
</tr>
<tr>
<td>-hdc xx</td>
<td>üçüncü hard disk imajı</td>
</tr>
<tr>
<td>-hdd xx</td>
<td>dördüncü disk imajı</td>
</tr>
<tr>
<td>-cpu host</td>
<td>yerel makinanın işlemci ismini sanal makinada kullan</td>
</tr>
<tr>
<td>-smp cores=2</td>
<td>çift çekirdek kullan</td>
</tr>
<tr>
<td>-vga cirrus</td>
<td>ekran kartı olarak cirrus göster</td>
</tr>
<tr>
<td>-vga vmware</td>
<td>ekran kartı olarak vmware göster</td>
</tr>
<tr>
<td>-display vnc:0</td>
<td>görüntüyü vnc üzerinden al (5900 portundan)</td>
</tr>
<tr>
<td>-soundhw ac97</td>
<td>ses kartı olarak ac97 ekle</td>
</tr>
<tr>
<td>-nic user,hostfwd=tcp::2222-:22</td>
<td>Sanal makinadaki 22 portunu hostun 2222 portuna yönlendir</td>
</tr>
<tr>
<td>-bios /usr/share/ovmf/OVMF.fd</td>
<td>UEFI olarak başlat</td>
</tr>
</tbody>
</table>
<h2 id="biti-">Bitiş</h2>
<p>Umarım bu yazıyla size qemu-kvm kullanımını anlata bilmişimdir. Aşağıdaki adreslerden bana ulaşa bilirsiniz.</p>
<p>Email: subhanqedirli@protonmail.com                 <a href="https://www.youtube.com/channel/UCCyrdKjOWMQFu4MpAuD9ajg">Youtube</a> <a href="https://discord.gg/jwR4sAYQ5n">Discord</a> <a href="https://matrix.to/#/!kSPvsnjXUJDMJszYek:matrix.org?via=matrix.org">Matrix</a> <a href="https://t.me/LinuxisnotUNIXchannel">Telegram</a> <a href="https://mastodon.social/@subhanqedirli">Mastodon</a>  </p>
</body></html>